<!doctype html>
<html lang='en'>
<head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<title>MR Flashing v6.0 â€” Matrix Roofing</title>
<link rel='manifest' href='manifest.json'><meta name='theme-color' content='#003A75'>
<style>body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial}*{box-sizing:border-box}
.appbar{display:flex;gap:12px;align-items:center;padding:10px 12px;border-bottom:1px solid #e7e9ec;background:#fff}
.logo{font-weight:800;color:#003A75}.appname{font-weight:600}
.toolbar{margin-left:auto;display:flex;gap:8px;flex-wrap:wrap}
.btn{border:1px solid #cfd6dd;background:#fff;padding:8px 10px;border-radius:8px;cursor:pointer}.btn.primary{background:#003A75;color:#fff;border-color:#003A75}
.wrapper{display:grid;grid-template-columns:360px 1fr;grid-template-rows:auto 1fr auto;min-height:calc(100vh - 48px)}
.sidebar{border-right:1px solid #e7e9ec;padding:10px;background:#fff;overflow:auto}
.section{border-bottom:1px solid #eef1f4;padding-bottom:10px;margin-bottom:12px}
label{font-size:12px;color:#333;display:flex;flex-direction:column;gap:4px;margin-bottom:8px}
input,select,textarea{padding:8px;border:1px solid #cfd6dd;border-radius:8px;width:100%}textarea{min-height:68px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:8px}.row{display:flex;gap:8px;align-items:center}
.swatch{width:100%;height:28px;border:1px solid #cfd6dd;border-radius:8px;margin-top:6px}
.stage{position:relative;background:linear-gradient(0deg,rgba(0,0,0,.06) 1px,transparent 1px),linear-gradient(90deg,rgba(0,0,0,.06) 1px,transparent 1px);background-size:24px 24px;overflow:auto}
#cv{border:1px solid #aeb6bf;background:#fff;display:block;margin:16px;touch-action:none;max-width:100%}
.inline-input{position:absolute;z-index:10;transform:translate(-50%,-50%)}.inline-input input{padding:6px 8px;font-size:14px;border:2px solid #d00;border-radius:8px;min-width:90px;text-align:center}
.orders{padding:10px;border-top:1px solid #e7e9ec;background:#fff}.table{width:100%;border-collapse:collapse}
.table th,.table td{border:1px solid #e1e5ea;padding:8px;font-size:13px;vertical-align:top}.table th{background:#f7f9fb;text-align:left}
.footer{padding:12px;border-top:1px solid #e7e9ec;background:#fafbfc;color:#4b4f56;font-size:12px}</style></head>
<body>
<header class='appbar'><div class='logo'>MATRIX ROOFING</div><div class='appname'>MR Flashing v6.0</div>
  <div class='toolbar'>
    <button id='actNew' class='btn'>New</button><button id='actSave' class='btn'>Save</button>
    <button id='actLoad' class='btn'>Load</button><button id='actExport' class='btn'>Export Design PDF</button>
    <button id='actShare' class='btn'>Share Link</button><button id='dotMode' class='btn'>Dot Mode: ON</button>
    <button id='actAdd' class='btn primary'>Add to Order</button>
  </div></header>
<div class='wrapper'>
  <aside class='sidebar'>
    <div class='section'>
      <div class='grid2'>
        <label>Zoom<input id='zoom' type='range' min='0.5' max='3' step='0.1' value='1'></label>
        <label>Scale (px/mm)<input id='scale' type='number' step='0.1' value='1'></label>
      </div>
      <div class='grid2'>
        <label>Snap (px)<input id='snap' type='number' value='6'></label>
        <label>Face<select id='face'><option value='left'>Left</option><option value='right'>Right</option></select></label>
      </div>
      <div class='row'>
        <button id='lock' class='btn' style='flex:1'>ðŸ”’ Lock</button>
        <button id='undo' class='btn' style='flex:1'>â†©ï¸Ž Undo</button>
        <button id='redo' class='btn' style='flex:1'>â†ªï¸Ž Redo</button>
      </div>
    </div>
    <div class='section'>
      <label>Colourbond<select id='colour'>
        <option value='#ECEBE6'>Surfmist</option><option value='#D6D0BE'>Evening Haze</option><option value='#F4E3BE'>Classic Cream</option>
        <option value='#CBB99E'>Paperbark</option><option value='#B7B9B7'>Shale Grey</option><option value='#B3ADA0'>Dune</option>
        <option value='#918A78'>Cove</option><option value='#5E6D57'>Pale Eucalypt</option><option value='#4B4F46'>Woodland Grey</option>
        <option value='#8F9697'>Windspray</option><option value='#7E726B'>Gully</option><option value='#6E6F5B'>Mangrove</option>
        <option value='#2F3A56'>Deep Ocean</option><option value='#2B5C4B'>Cottage Green</option><option value='#8C867B'>Wallaby</option>
        <option value='#7C5A46'>Jasper</option><option value='#6A6C6E'>Basalt</option><option value='#7E2B2B'>Manor Red</option>
        <option value='#1A1A1A'>Night Sky</option><option value='#434E5A'>Ironstone</option><option value='#7A4A3B'>Terrain</option><option value='#2B2B2B'>Monument</option>
      </select><div id='swatch' class='swatch'></div></label>
      <div class='grid2'>
        <label>Material<select id='material'><option>COLORBOND</option><option>ZINCALUME</option><option>GALVABOND</option></select></label>
        <label>Thickness (BMT)<select id='thickness'><option>0.55</option><option>0.48</option><option>0.42</option></select></label>
      </div>
      <label class='row' style='justify-content:space-between'><span>Hem (safe edges)</span><input id='hems' type='checkbox'></label>
    </div>
    <div class='section'>
      <div class='grid2'><label>Seg #<input id='seg' type='number' value='0' min='0'></label><label>Length (mm)<input id='segLen' type='number' value='0'></label></div>
      <label>Angle (Â°)<input id='segAng' type='number' value='0' step='0.1'></label><button id='apply' class='btn'>Apply Segment</button>
    </div>
    <div class='section'>
      <label>Name<input id='name' value='Flashing'></label>
      <label>Lengths (mm, commaâ€‘separated)<div class='row'><input id='lenList' type='text' value='2400'><button class='btn' id='addLengths' type='button'>Parse</button></div></label>
      <div class='grid2'><label>Default Qty<input id='qty' type='number' value='1' min='1' step='1'></label><label>Gauge<input id='gauge' value='0.55'></label></div>
    </div>
    <div class='section'>
      <div class='grid2'><label>Customer Name<input id='custName'></label><label>Phone<input id='custPhone'></label></div>
      <div class='grid2'><label>Email<input id='custEmail'></label><label>Job Ref / PO<input id='jobRef'></label></div>
      <label>Delivery<select id='delivery'><option>Pickup</option><option>Delivery</option></select></label>
      <label>Order Notes<textarea id='orderNotes' placeholder='Site, access, special bends, mitres, toleranceâ€¦'></textarea></label>
    </div>
  </aside>
  <main class='stage' id='stage'><canvas id='cv' width='1280' height='720'></canvas><div id='overlay'></div></main>
  <section class='orders'>
    <div style='display:flex;align-items:center;gap:10px;margin-bottom:6px'><strong>Orders</strong>
      <button id='exportOrders' class='btn'>Export Orders PDF</button><button id='emailOrders' class='btn'>Email Order</button><button id='clearOrders' class='btn'>Clear</button>
      <div style='margin-left:auto'>Total items: <span id='orderCount'>0</span></div>
    </div>
    <div style='overflow:auto'><table class='table' id='orderTable'><thead><tr>
      <th>Preview</th><th>Name</th><th>Material</th><th>Colour</th><th>Thk</th><th>F</th><th>GIRTH</th><th>Q Ã— L (mm)</th><th>T</th><th>Notes</th><th>Actions</th>
    </tr></thead><tbody id='orderBody'></tbody></table></div>
  </section>
</div>
<footer class='footer'>Matrix Roofing â€” Roof Restorations & Custom Flashings Â· Melbourne VIC Â· 1300 980 779 Â· www.matrixroofing.com.au</footer>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'></script>
<script>
const cv=document.getElementById('cv'),ctx=cv.getContext('2d'),overlay=document.getElementById('overlay');
let Z=1,pxPerMm=1,snap=6,locked=false,drawing=false;let path=[],history=[],redoStack=[],dotMode=true,hoverPos=null;
const faceSel=document.getElementById('face'),colourSel=document.getElementById('colour'),swatch=document.getElementById('swatch');swatch.style.background=colourSel.value;colourSel.onchange=()=>swatch.style.background=colourSel.value;
document.getElementById('dotMode').onclick=()=>{dotMode=!dotMode;document.getElementById('dotMode').textContent='Dot Mode: '+(dotMode?'ON':'OFF');};
document.getElementById('undo').onclick=()=>{if(history.length){redoStack.push(JSON.stringify(path));path=JSON.parse(history.pop());draw();}};
document.getElementById('redo').onclick=()=>{if(redoStack.length){history.push(JSON.stringify(path));path=JSON.parse(redoStack.pop());draw();}};
document.getElementById('zoom').oninput=e=>{Z=parseFloat(e.target.value||'1');draw();};
document.getElementById('scale').onchange=e=>{pxPerMm=parseFloat(e.target.value||'1');draw();};
document.getElementById('snap').onchange=e=>{snap=parseInt(e.target.value||'0');};
document.getElementById('lock').onclick=()=>{locked=!locked;document.getElementById('lock').textContent=locked?'ðŸ”“ Unlock':'ðŸ”’ Lock';};
document.getElementById('actNew').onclick=()=>{if(path.length>1&&!confirm('Clear current drawing?'))return;path=[];history.length=0;redoStack.length=0;draw();};
function pushHist(){history.push(JSON.stringify(path));if(history.length>200)history.shift();redoStack.length=0;}
function pos(e){const r=cv.getBoundingClientRect();const x=((e.touches?e.touches[0].clientX:e.clientX)-r.left)/Z;const y=((e.touches?e.touches[0].clientY:e.clientY)-r.top)/Z;return{x,y};}
function snapP(p){if(!snap)return p;return{x:Math.round(p.x*snap)/snap,y:Math.round(p.y*snap)/snap};}
function down(e){const p=pos(e),sp=snapP(p);if(locked){pickAt({x:p.x*Z,y:p.y*Z});e.preventDefault();return;}if(dotMode){if(!path.length){pushHist();path=[sp];}else{pushHist();path.push(sp);}drawing=true;draw();e.preventDefault();return;}if(!drawing){pushHist();path=[sp];drawing=true;}else{pushHist();path.push(sp);}draw();e.preventDefault();}
function move(e){hoverPos=pos(e);if(!path.length||locked){draw();return;}if(dotMode){draw();return;}if(drawing){path[path.length-1]=snapP(pos(e));draw();}}
function up(e){e.preventDefault();}
cv.addEventListener('pointerdown',down,{passive:false});cv.addEventListener('pointermove',move,{passive:false});cv.addEventListener('pointerup',up,{passive:false});
cv.addEventListener('touchstart',down,{passive:false});cv.addEventListener('touchmove',move,{passive:false});cv.addEventListener('touchend',up,{passive:false});
cv.addEventListener('mousedown',down);cv.addEventListener('mousemove',move);['mouseup','mouseleave'].forEach(ev=>cv.addEventListener(ev,up));
function normal(ax,ay,bx,by){const dx=bx-ax,dy=by-ay;const L=Math.hypot(dx,dy)||1;return{x:-dy/L,y:dx/L}}
function cornerAngle(prev,pt,next){const v1={x:prev.x-pt.x,y:prev.y-pt.y},v2={x:next.x-pt.x,y:next.y-pt.y};const dot=v1.x*v2.x+v1.y*v2.y,l1=Math.hypot(v1.x,v1.y),l2=Math.hypot(v2.x,v2.y);if(l1*l2===0)return 0;let ang=Math.acos(Math.max(-1,Math.min(1,dot/(l1*l2))));return +(Math.min(ang*180/Math.PI,180)).toFixed(1);}
function roundRect(ctx,x,y,w,h,r){ctx.beginPath();ctx.moveTo(x+r,y);ctx.arcTo(x+w,y,x+w,y+h,r);ctx.arcTo(x+w,y+h,x,y+h,r);ctx.arcTo(x,y+h,x,y,r);ctx.arcTo(x,y,x+w,y,r);}
function drawBadge(cx,cy,text){ctx.font='12px system-ui,-apple-system';const w=ctx.measureText(text).width+12,h=18;ctx.fillStyle='#d00';roundRect(ctx,cx-w/2,cy-h/2,w,h,9);ctx.fill();ctx.fillStyle='#fff';ctx.fillText(text,cx-w/2+6,cy+4);}
function draw(){ctx.clearRect(0,0,cv.width,cv.height);if(!path.length)return;ctx.save();ctx.scale(Z,Z);ctx.strokeStyle='#000';ctx.lineWidth=2/Z;ctx.beginPath();ctx.moveTo(path[0].x,path[0].y);for(let i=1;i<path.length;i++)ctx.lineTo(path[i].x,path[i].y);ctx.stroke();const face=faceSel.value,hex=colourSel.value;ctx.strokeStyle=hex;ctx.lineWidth=6/Z;ctx.globalAlpha=.35;for(let i=0;i<path.length-1;i++){const a=path[i],b=path[i+1];const n=normal(a.x,a.y,b.x,b.y);const off=face==='left'?6:-6;ctx.beginPath();ctx.moveTo(a.x+n.x*off,a.y+n.y*off);ctx.lineTo(b.x+n.x*off,b.y+n.y*off);ctx.stroke();}ctx.globalAlpha=1;ctx.fillStyle='#000';for(const p of path){ctx.beginPath();ctx.arc(p.x,p.y,3/Z,0,Math.PI*2);ctx.fill();}const r=20;ctx.strokeStyle='#555';ctx.lineWidth=1/Z;ctx.setLineDash([4/Z,3/Z]);for(let i=1;i<path.length-1;i++){const pm=path[i-1],p=path[i],pn=path[i+1];let a1=Math.atan2(pm.y-p.y,pm.x-p.x),a2=Math.atan2(pn.y-p.y,pn.x-p.x);let d=a2-a1;while(d>Math.PI){a2-=2*Math.PI;d=a2-a1}while(d<-Math.PI){a2+=2*Math.PI;d=a2-a1}ctx.beginPath();ctx.arc(p.x,p.y,r,a1,a2);ctx.stroke();}ctx.setLineDash([]);if(dotMode&&hoverPos&&path.length&&!locked){const a=path[path.length-1],b=snapP(hoverPos);ctx.strokeStyle='#888';ctx.lineWidth=1.5/Z;ctx.setLineDash([6/Z,6/Z]);ctx.beginPath();ctx.moveTo(a.x,a.y);ctx.lineTo(b.x,b.y);ctx.stroke();ctx.setLineDash([]);}ctx.restore();for(let i=0;i<path.length-1;i++){const a=path[i],b=path[i+1];const L=Math.hypot(b.x-a.x,b.y-a.y)/pxPerMm;const midx=(a.x+b.x)/2*Z,midy=(a.y+b.y)/2*Z;drawBadge(midx,midy,Math.round(L)+' mm');}for(let i=1;i<path.length-1;i++){const ang=cornerAngle(path[i-1],path[i],path[i+1]);drawBadge(path[i].x*Z+8,path[i].y*Z-8,ang+'Â°');}}
function clearInline(){overlay.innerHTML=''}function showInline(x,y,val,onEnter){clearInline();const w=document.createElement('div');w.className='inline-input';w.style.left=x+'px';w.style.top=y+'px';const inp=document.createElement('input');inp.value=val;w.appendChild(inp);overlay.appendChild(w);inp.focus();inp.select();inp.addEventListener('keydown',ev=>{if(ev.key==='Enter'){onEnter(parseFloat(inp.value));clearInline();draw();}if(ev.key==='Escape'){clearInline();draw();}})}
function pickAt(sp){let bestKind=null,bestIndex=-1,bestd=1e9,bestPt=null;for(let i=0;i<path.length-1;i++){const a=path[i],b=path[i+1];const mx=(a.x+b.x)/2*Z,my=(a.y+b.y)/2*Z;const d=Math.hypot(sp.x-mx,sp.y-my);if(d<bestd){bestd=d;bestKind='seg';bestIndex=i;bestPt={x:mx,y:my};}}for(let i=1;i<path.length-1;i++){const bx=path[i].x*Z+8,by=path[i].y*Z-8;const d=Math.hypot(sp.x-bx,sp.y-by);if(d<bestd){bestd=d;bestKind='corner';bestIndex=i;bestPt={x:bx,y:by};}}if(bestd<42){if(bestKind==='seg'){const a=path[bestIndex],b=path[bestIndex+1];const dx=b.x-a.x,dy=b.y-a.y;const L=Math.hypot(dx,dy)/pxPerMm;showInline(bestPt.x,bestPt.y,Math.round(L),(newLen)=>{const ang=Math.atan2(-dy,dx);const m=(newLen||0)*pxPerMm;path[bestIndex+1]={x:a.x+m*Math.cos(ang),y:a.y-m*Math.sin(ang)};});}else{const ang=cornerAngle(path[bestIndex-1],path[bestIndex],path[bestIndex+1]);showInline(bestPt.x,bestPt.y,ang,(newAng)=>{applyCorner(bestIndex,newAng);});}}}
function applyCorner(i,deg){if(path.length<3)return;i=Math.max(1,Math.min(i,path.length-2));const desired=Math.max(0,Math.min(180,parseFloat(deg)||0))*Math.PI/180;const Pm=path[i-1],P=path[i],Pn=path[i+1];const vPrev={x:P.x-Pm.x,y:P.y-Pm.y};const thetaPrev=Math.atan2(vPrev.y,vPrev.x);const delta=Math.PI-desired;const cur=Math.atan2(Pn.y-P.y,Pn.x-P.x);const wrap=a=>Math.atan2(Math.sin(a),Math.cos(a));const opt1=thetaPrev+delta,opt2=thetaPrev-delta;const d1=Math.abs(wrap(cur-opt1)),d2=Math.abs(wrap(cur-opt2));const theta=d1<=d2?opt1:opt2;const L=Math.hypot(Pn.x-P.x,Pn.y-P.y);path[i+1]={x:P.x+L*Math.cos(theta),y:P.y+L*Math.sin(theta)};draw();}
document.getElementById('apply').onclick=()=>{if(path.length<2)return;const i=Math.min(parseInt(document.getElementById('seg').value||'0',10),path.length-2);const a=path[i];const L=(parseFloat(document.getElementById('segLen').value)||0)*pxPerMm;const ang=(parseFloat(document.getElementById('segAng').value)||0)*Math.PI/180;path[i+1]={x:a.x+L*Math.cos(ang),y:a.y+L*Math.sin(ang)};draw();};
function snapshot(){return cv.toDataURL('image/png')}function foldCount(){return Math.max(0,path.length-1)}function girth(){let g=0;for(let i=0;i<path.length-1;i++){const a=path[i],b=path[i+1];g+=Math.hypot(b.x-a.x,b.y-a.y)/pxPerMm;}return Math.round(g)}
const orders=[];function renderOrders(){const body=document.getElementById('orderBody');body.innerHTML='';document.getElementById('orderCount').textContent=String(orders.length);orders.forEach((o,i)=>{const tr=document.createElement('tr');tr.setAttribute('data-i',i);tr.innerHTML=`<td><img src="${o.image}" style="width:120px;height:auto;border:1px solid #ddd;border-radius:6px"></td>
<td>${o.name}</td><td>${o.material}</td><td>${o.colourName}</td><td>${o.thickness}</td><td>${o.F}</td><td>${o.GIRTH}</td>
<td><div class='row'><input class='cell-qty' type='number' min='1' step='1' value='${o.qty}' style='width:68px'> Ã— <input class='cell-length' type='number' min='10' step='10' value='${o.length_mm}' style='width:90px'> mm</div></td>
<td>${o.T}</td><td contenteditable='true' class='cell-notes'>${o.notes||''}</td><td><button class='btn btn-del' data-del='${i}'>Remove</button></td>`;body.appendChild(tr);});body.querySelectorAll('.btn-del').forEach(b=>b.onclick=()=>{orders.splice(parseInt(b.dataset.del),1);renderOrders()});body.querySelectorAll('tr').forEach(row=>{const i=parseInt(row.getAttribute('data-i'));const qtyIn=row.querySelector('.cell-qty');const lenIn=row.querySelector('.cell-length');const notesEl=row.querySelector('.cell-notes');qtyIn.addEventListener('change',()=>{orders[i].qty=Math.max(1,parseInt(qtyIn.value||'1',10));});lenIn.addEventListener('change',()=>{orders[i].length_mm=Math.max(10,parseInt(lenIn.value||'10',10));});notesEl.addEventListener('input',()=>{orders[i].notes=notesEl.textContent;});});}
document.getElementById('actAdd').onclick=()=>{if(path.length<2){alert('Draw first');return;}const list=(document.getElementById('lenList').value||'').split(',').map(s=>parseInt(s.trim(),10)).filter(n=>!isNaN(n)&&n>0);const qtyDefault=Math.max(1,parseInt(document.getElementById('qty').value||'1',10));if(!list.length){alert('Enter at least one length (mm)');return;}const base={name:document.getElementById('name').value||'Flashing',gauge:document.getElementById('gauge').value||'0.55',material:document.getElementById('material').value,thickness:document.getElementById('thickness').value,colourName:colourSel.options[colourSel.selectedIndex].text,colourHex:colourSel.value,face:faceSel.value,F:foldCount(),GIRTH:girth(),T:(girth()/1000).toFixed(1),hems:document.getElementById('hems').checked,image:snapshot(),notes:''};list.forEach(L=>orders.push({id:String(Date.now())+Math.random().toString(36).slice(2,6),...base,length_mm:L,qty:qtyDefault}));renderOrders();};
document.getElementById('clearOrders').onclick=()=>{orders.length=0;renderOrders()};
document.getElementById('emailOrders').onclick=()=>{if(!orders.length){alert('No items');return;}const head=`Customer: ${document.getElementById('custName').value||''}
Phone: ${document.getElementById('custPhone').value||''}
Email: ${document.getElementById('custEmail').value||''}
Job Ref: ${document.getElementById('jobRef').value||''}
Delivery: ${document.getElementById('delivery').value}
Notes: ${(document.getElementById('orderNotes').value||'').replace(/\n/g,' ')}`;const lines=orders.map((o,i)=>`${i+1}. ${o.name} x${o.qty} â€” ${o.length_mm}mm, ${o.gauge} ${o.thickness}BMT ${o.material}, ${o.colourName}${o.hems?' (hems)':''} (F:${o.F} G:${o.GIRTH} T:${o.T})`).join('\n');location.href='mailto:?subject=MR Flashing Order&body='+encodeURIComponent(head+'\n\n'+lines);};
document.getElementById('exportOrders').onclick=()=>{if(!orders.length){alert('No items');return;}const { jsPDF }=window.jspdf;const doc=new jsPDF({unit:'pt',format:'a4'});let y=40;doc.setFontSize(14);doc.setTextColor(0,58,117);doc.text('MATRIX ROOFING â€” MR FLASHING ORDER',40,y);y+=24;doc.setTextColor(0,0,0);doc.setFontSize(10);doc.text('Customer: '+(document.getElementById('custName').value||''),40,y);y+=14;doc.text('Phone: '+(document.getElementById('custPhone').value||''),40,y);y+=14;doc.text('Email: '+(document.getElementById('custEmail').value||''),40,y);y+=14;doc.text('Job Ref: '+(document.getElementById('jobRef').value||''),40,y);y+=14;doc.text('Delivery: '+document.getElementById('delivery').value,40,y);y+=18;const notes=(document.getElementById('orderNotes').value||'');if(notes){doc.setFontSize(9);doc.text('Notes: '+notes,40,y,{maxWidth:520});y+=22;}else{y+=6;}doc.setFontSize(9);function row(c){let x=40;const w=[80,70,70,80,40,50,100,50,120];for(let i=0;i<c.length;i++){doc.rect(x,y,w[i],18);doc.text(String(c[i]),x+6,y+12);x+=w[i];}y+=18;}row(['Name','Material','Colour','Gauge/Thk','F','GIRTH','Q Ã— L (mm)','T','Notes']);orders.forEach(o=>row([o.name,o.material,o.colourName,o.gauge+'/'+o.thickness,o.F,o.GIRTH,(o.qty+' Ã— '+o.length_mm),o.T,(o.notes||'')]));y+=16;doc.setFontSize(8);doc.text('Matrix Roofing â€” Roof Restorations & Custom Flashings Â· Melbourne VIC Â· 1300 980 779 Â· www.matrixroofing.com.au',40,y);doc.save('mr-flashing-order.pdf');};
// share/save/load design only
function currentDesign(){return{meta:{app:'MR Flashing',version:'v6.0',brand:'Matrix Roofing',ts:Date.now()},drawing:{path:path.map(p=>({x:p.x,y:p.y})),pxPerMm,Z,snap,colourHex:colourSel.value,face:faceSel.value}}}
function applyDesign(d){if(!d)return;path=d.drawing&&d.drawing.path||[];pxPerMm=d.drawing&&d.drawing.pxPerMm||1;Z=d.drawing&&d.drawing.Z||1;snap=d.drawing&&d.drawing.snap||6;if(d.drawing&&d.drawing.colourHex)colourSel.value=d.drawing.colourHex;if(d.drawing&&d.drawing.face)faceSel.value=d.drawing.face;swatch.style.background=colourSel.value;draw();}
document.getElementById('actSave').onclick=()=>{const d=currentDesign();localStorage.setItem('mr-flashing-v60',JSON.stringify(d));const blob=new Blob([JSON.stringify(d,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='design.mrfl.json';a.click();};
document.getElementById('actLoad').onclick=()=>{const inp=document.createElement('input');inp.type='file';inp.accept='.json,.mrfl.json,application/json';inp.onchange=()=>{const f=inp.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{applyDesign(JSON.parse(r.result));}catch(e){alert('Invalid file');}};r.readAsText(f);};inp.click();};
document.getElementById('actShare').onclick=()=>{const enc=btoa(unescape(encodeURIComponent(JSON.stringify(currentDesign()))));const url=location.origin+location.pathname+'#d='+enc;navigator.clipboard&&navigator.clipboard.writeText(url);alert('Share link copied to clipboard.');};
(function init(){const saved=localStorage.getItem('mr-flashing-v60');if(saved){try{applyDesign(JSON.parse(saved));}catch(e){}}draw();})();
</script></body></html>