<!doctype html>
<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width,initial-scale=1'>
<title>MR Flashing v5.7</title>
<style>
body{margin:0;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial}
header{padding:10px;border-bottom:1px solid #ddd}
canvas{border:1px solid #999;touch-action:none;max-width:100%;background:#fff}
.inline{position:absolute;transform:translate(-50%,-50%)}
.badge{background:#d00;color:#fff;border-radius:12px;padding:2px 6px;font-size:12px}
.gridbg{background:linear-gradient(0deg,rgba(0,0,0,.06) 1px, transparent 1px),linear-gradient(90deg,rgba(0,0,0,.06) 1px, transparent 1px);background-size:24px 24px;}
</style></head>
<body>
<header><strong>MR Flashing v5.7</strong></header>
<div style='padding:10px;position:relative'>
  <canvas id='cv' class='gridbg' width='980' height='560'></canvas>
</div>
<script>
const cv=document.getElementById('cv'),ctx=cv.getContext('2d');
let Z=1, pxPerMm=1;
let path=[{x:200,y:280},{x:420,y:280},{x:500,y:200},{x:620,y:200}]; // sample shape for preview

function shortestArcAngles(p, pm, pn){
  let a1=Math.atan2(pm.y-p.y, pm.x-p.x);
  let a2=Math.atan2(pn.y-p.y, pn.x-p.x);
  let diff=a2-a1;
  while(diff>Math.PI){ a2-=2*Math.PI; diff=a2-a1; }
  while(diff<-Math.PI){ a2+=2*Math.PI; diff=a2-a1; }
  return {start:a1, end:a2, diff};
}
function interiorAngle(pm,p,pn){
  const v1={x:pm.x-p.x,y:pm.y-p.y}, v2={x:pn.x-p.x,y:pn.y-p.y};
  const dot=v1.x*v2.x+v1.y*v2.y, l1=Math.hypot(v1.x,v1.y), l2=Math.hypot(v2.x,v2.y);
  const a=Math.acos(Math.max(-1,Math.min(1,dot/(l1*l2))))||0; return +(Math.min(a*180/Math.PI,180)).toFixed(1);
}
function drawCurvedTextOnArc(text, p, pm, pn){
  const r=22, {start,end,diff}=shortestArcAngles(p,pm,pn);
  const w=ctx.measureText(text).width, rS=r*Z, angW=Math.max(0.001, w/rS);
  const startText=(start+end)/2 - angW/2;
  let cur=startText;
  for(const ch of text){
    const cw=ctx.measureText(ch).width, aStep=cw/rS, aMid=cur+aStep/2;
    ctx.save(); ctx.translate(p.x*Z + rS*Math.cos(aMid), p.y*Z + rS*Math.sin(aMid));
    ctx.rotate(aMid + Math.PI/2); ctx.fillStyle='#d00'; ctx.fillText(ch, -cw/2, 4); ctx.restore();
    cur+=aStep;
  }
}
function draw(){
  ctx.clearRect(0,0,cv.width,cv.height);
  // polyline
  ctx.save(); ctx.scale(Z,Z);
  ctx.strokeStyle='#000'; ctx.lineWidth=2/Z;
  ctx.beginPath(); ctx.moveTo(path[0].x,path[0].y); for(let i=1;i<path.length;i++) ctx.lineTo(path[i].x,path[i].y); ctx.stroke();
  // arcs
  const r=20; ctx.strokeStyle='#555'; ctx.lineWidth=1/Z; ctx.setLineDash([4/Z,3/Z]);
  for(let i=1;i<path.length-1;i++){ const pm=path[i-1], p=path[i], pn=path[i+1]; const {start,end}=shortestArcAngles(p,pm,pn); ctx.beginPath(); ctx.arc(p.x,p.y,r,start,end); ctx.stroke(); }
  ctx.setLineDash([]); ctx.restore();
  // curved labels
  ctx.font='12px system-ui,-apple-system';
  for(let i=1;i<path.length-1;i++){ const pm=path[i-1], p=path[i], pn=path[i+1]; drawCurvedTextOnArc(interiorAngle(pm,p,pn)+'Â°', p, pm, pn); }
}
draw();
</script>
</body></html>
